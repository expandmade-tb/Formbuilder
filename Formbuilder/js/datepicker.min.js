class Datepicker{static activePicker=null;constructor(e,t="yyyy-mm-dd",n="en"){const a=["dd.mm.yyyy","dd/mm/yyyy","mm/dd/yyyy","yyyy-mm-dd","Y-m-d"];if(!a.includes(t))throw new Error(`Invalid date format: ${t}. Supported formats are: ${a.join(", ")}`);if(this.input=document.querySelector(e),!this.input)throw new Error(`No element found with selector: ${e}`);["de","en","es"].includes(n)||(n="en"),this.format=t,this.lang=n,this.calendar=null,this.isNavigatingCalendar=!1;const r=new Date;this.currentYear=r.getFullYear(),this.currentMonth=r.getMonth(),this.init()}init(){this.input.addEventListener("focus",(()=>this.showCalendar())),this.input.addEventListener("blur",(e=>{setTimeout((()=>{this.calendar.contains(document.activeElement)||this.isNavigatingCalendar||this.hideCalendar()}),200)})),document.addEventListener("mousedown",(e=>{this.calendar&&!this.calendar.contains(e.target)&&e.target!==this.input&&this.hideCalendar()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&this.hideCalendar()}))}showCalendar(){Datepicker.activePicker&&Datepicker.activePicker!==this&&Datepicker.activePicker.hideCalendar(),Datepicker.activePicker=this,this.calendar||(this.calendar=document.createElement("div"),this.calendar.className="datepicker-calendar",this.calendar.tabIndex=-1,this.calendar.style.position="absolute",document.body.appendChild(this.calendar));const e=this.parseDate(this.input.value);if(e)this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth();else{const e=new Date;this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth()}this.renderCalendar(),this.calendar.style.visibility="hidden",this.calendar.style.display="block";const t=this.input.getBoundingClientRect(),n=this.calendar.getBoundingClientRect(),a=window.innerWidth,r=window.innerHeight;let i=t.bottom+window.scrollY,s=t.left+window.scrollX;const d=r-t.bottom,l=t.top,c=a-t.left,o=t.right;d<n.height&&l>n.height&&(i=t.top+window.scrollY-n.height),c<n.width&&o>n.width&&(s=t.right+window.scrollX-n.width),this.calendar.style.top=`${i}px`,this.calendar.style.left=`${s}px`,this.calendar.style.visibility=""}hideCalendar(){this.calendar&&(this.calendar.style.display="none")}renderCalendar(){const e=this.parseDate(this.input.value),t=(e||new Date,this.currentYear),n=this.currentMonth,a=new Date(t,n,1).getDay(),r=new Date(t,n+1,0).getDate(),i={de:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}[this.lang],s={de:["So","Mo","Di","Mi","Do","Fr","Sa"],en:["Su","Mo","Tu","We","Th","Fr","Sa"],es:["Do","Lu","Ma","Mi","Ju","Vi","Sa"]}[this.lang];let d=`\n      <div class="datepicker-nav">\n        <button class="prev-month">&#8592;</button>\n        <span>${i[n]} ${t}</span>\n        <button class="next-month">&#8594;</button>\n      </div>\n      <div class="datepicker-weekdays">${s.map((e=>`<span>${e}</span>`)).join("")}</div>\n      <div class="datepicker-grid">\n    `;for(let e=0;e<a;e++)d+="<span></span>";for(let a=1;a<=r;a++){const r=new Date(t,n,a);d+=`<button data-day="${a}" class="${e&&e.getDate()===r.getDate()&&e.getMonth()===r.getMonth()&&e.getFullYear()===r.getFullYear()?"selected":""}">${a}</button>`}d+="</div>",d+=`<div class="datepicker-footer"><button class="today-btn">${"de"===this.lang?"Heute":"es"===this.lang?"Hoy":"Today"}</button></div>`,this.calendar.innerHTML=d,this.calendar.querySelector(".prev-month").onclick=()=>{this.isNavigatingCalendar=!0,this.currentMonth--,this.currentMonth<0&&(this.currentMonth=11,this.currentYear--),this.renderCalendar()},this.calendar.querySelector(".next-month").onclick=()=>{this.isNavigatingCalendar=!0,this.currentMonth++,this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()},this.calendar.querySelectorAll("[data-day]").forEach((e=>{e.onclick=()=>{const t=+e.dataset.day,n=new Date(this.currentYear,this.currentMonth,t);this.input.value=this.formatDate(n),this.hideCalendar()}})),this.calendar.querySelector(".today-btn").onclick=()=>{const e=new Date;this.input.value=this.formatDate(e),this.currentYear=e.getFullYear(),this.currentMonth=e.getMonth(),this.hideCalendar()}}parseDate(e){if(!e)return null;const t=e.match(/[-\/.]/);if(!t)return null;const n=t[0],a=e.split(n).map(Number);if(3!==a.length||a.some(isNaN))return null;let r,i,s;switch(this.format){case"dd.mm.yyyy":case"dd/mm/yyyy":[r,i,s]=a;break;case"mm/dd/yyyy":[i,r,s]=a;break;case"yyyy-mm-dd":case"Y-m-d":[s,i,r]=a;break;default:return null}const d=new Date(s,i-1,r);return d.getFullYear()!==s||d.getMonth()!==i-1||d.getDate()!==r?null:d}formatDate(e){const t=e=>e<10?"0"+e:e,n=t(e.getDate()),a=t(e.getMonth()+1),r=e.getFullYear();switch(this.format){case"dd.mm.yyyy":return`${n}.${a}.${r}`;case"dd/mm/yyyy":return`${n}/${a}/${r}`;case"mm/dd/yyyy":return`${a}/${n}/${r}`;case"yyyy-mm-dd":case"Y-m-d":return`${r}-${a}-${n}`;default:return e.toDateString()}}}